{
  "name": "enriched_social_data",
  "strict": true,
  "schema": {
    "type": "object",
    "additionalProperties": false,
    "required": [
      "source",
      "source_id",
      "url",
      "permalink",
      "title",
      "text",
      "parent_source",
      "subsource",
      "author",
      "country",
      "published_at",
      "language",
      "metrics",
      "topics",
      "symptoms",
      "treatments",
      "conditions",
      "companies",
      "engagement_score",
      "engagement_label",
      "key_phrases",
      "bariatric_context",
      "relevance_label",
      "relevance_confidence",
      "relevance_reason",
      "audience_label",
      "audience_confidence",
      "themes",
      "sentiment_label",
      "sentiment_confidence",
      "sentiment_raw",
      "emotions",
      "intent",
      "flags",
      "debug_matches"
    ],
    "properties": {
      "source": { "type": "string" },
      "source_id": { "type": "string" },
      "url": { "type": "string" },
      "permalink": { "anyOf": [{ "type": "string" }, { "type": "null" }] },
      "title": { "anyOf": [{ "type": "string" }, { "type": "null" }] },
      "text": { "type": "string" },
      "parent_source": { "anyOf": [{ "type": "string" }, { "type": "null" }] },
      "subsource": { "anyOf": [{ "type": "string" }, { "type": "null" }] },

      "author": {
        "type": "object",
        "additionalProperties": false,
        "required": ["id", "name", "handle", "gender", "age", "subscribers"],
        "properties": {
          "id": { "type": "string" },
          "name": { "type": "string" },
          "handle": { "type": "string" },
          "gender": { "anyOf": [{ "type": "string" }, { "type": "null" }] },
          "age": { "anyOf": [{ "type": "integer" }, { "type": "null" }] },
          "subscribers": { "anyOf": [{ "type": "integer" }, { "type": "null" }] }
        }
      },

      "country": { "anyOf": [{ "type": "string" }, { "type": "null" }] },
      "published_at": { "type": "string" },
      "language": { "anyOf": [{ "type": "string" }, { "type": "null" }] },

      "metrics": {
        "type": "object",
        "additionalProperties": false,
        "required": ["likes", "comments", "shares"],
        "properties": {
          "likes":    { "anyOf": [{ "type": "integer" }, { "type": "null" }] },
          "comments": { "anyOf": [{ "type": "integer" }, { "type": "null" }] },
          "shares":   { "anyOf": [{ "type": "integer" }, { "type": "null" }] }
        }
      },

      "topics":     { "type": "array", "items": { "type": "string" } },
      "symptoms":   { "type": "array", "items": { "type": "string" } },
      "treatments": { "type": "array", "items": { "type": "string" } },
      "conditions": { "type": "array", "items": { "type": "string" } },
      "companies":  { "type": "array", "items": { "type": "string" } },

      "engagement_score": { "type": "number" },
      "engagement_label": { "type": "string", "enum": ["low", "med", "high"] },

      "key_phrases": { "type": "array", "items": { "type": "string" } },

      "bariatric_context": { "type": "string", "enum": ["none", "weak", "strong"] },
      "relevance_label": { "type": "string", "enum": ["relevant", "borderline", "not_relevant"] },
      "relevance_confidence": { "type": "number" },
      "relevance_reason": { "type": "string" },

      "audience_label": { "type": "string", "enum": ["patient", "hcp", "industry", "media", "unknown"] },
      "audience_confidence": { "type": "number" },

      "themes": {
        "type": "array",
        "items": {
          "type": "string",
          "enum": ["Symptoms","Treatments","Conditions/Diagnosis","Bariatric Surgery","Access & Coverage","Diagnostics","Diet","Care Settings"]
        }
      },

      "sentiment_label": { "type": "string", "enum": ["positive","neutral","negative","mixed"] },
      "sentiment_confidence": { "type": "number" },
      "sentiment_raw": { "anyOf": [{ "type": "string" }, { "type": "null" }] },

      "emotions": {
        "type": "array",
        "items": {
          "type": "string",
          "enum": ["anger","fear","sadness","joy","frustration","anxiety","hope","relief"]
        }
      },

      "intent": {
        "type": "array",
        "items": {
          "type": "string",
          "enum": ["seeking_advice","sharing_experience","giving_advice","news","venting"]
        }
      },

      "flags": {
        "type": "array",
        "items": {
          "type": "string",
          "enum": ["possible_PBH_misattribution","crisis","adverse_event"]
        }
      },

      "debug_matches": { "type": "array", "items": { "type": "string" } }
    }
  }
}
